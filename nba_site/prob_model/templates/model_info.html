{% extends 'index.html' %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col -6 ">
            <h1>Team ratings:</h1>
            <div class="col scrollable-column-mini">
                <table class="table table-striped" id="sortable-table">
                    <thead>
                    <tr>
                        <th scope="col">Team Name</th>
                        <th scope="col">Rating</th>
                        <th scope="col">Variance</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for team, data in sims_dict.items %}
                        <tr>
                        <td>{{ team }}</td>
                        <td>{{ data.rating }}</td>
                        <td>{{ data.variance }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-6">
                <h1>Team rating vs variance</h1>
                <canvas id="scatterChart"></canvas>
                <script>
                    const ctx2 = document.getElementById('scatterChart').getContext('2d');
                    const sims_dict = {{ sims_dict|safe }};
                    
                    const data = [];
                    
                    // Extract data from sims_dict and create dataset
                    for (const team in sims_dict) {
                        data.push({
                            x: sims_dict[team].rating,
                            y: sims_dict[team].variance,
                            label: team,
                        });
                    }
                    
                    const scatterChart = new Chart(ctx2, {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                data: data,
                                pointBackgroundColor: 'blue',
                                pointRadius: 10,
                                label: 'Variance vs. Rating',
                            }],
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    title: {
                                        display: true,
                                        text: 'Rating',
                                    },
                                },
                                y: {
                                    beginAtZero: false,
                                    title: {
                                        display: true,
                                        text: 'Variance',
                                    },
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const team = context.dataset.data[context.dataIndex].label;
                                            return `${team}: Rating ${context.parsed.x}, Variance ${context.parsed.y}`;
                                        },
                                    }
                                }
                            }
                        }
                    });
                </script>
        </div>

    </div>
    <div class="row mb-4">
        <h1>Team Rating History</h1>
        <!-- Create a canvas for the Chart.js plot -->
        <canvas id="lineChart"></canvas>
        <script>
            const ctx = document.getElementById('lineChart').getContext('2d');
            const rating_dict = {{ rating_dict|safe }};
            
            const labels = [];
            const datasets = [];
            
            // Get the maximum number of games played by any team
            let maxGames = 0;
            for (const team in rating_dict) {
                maxGames = Math.max(maxGames, rating_dict[team].length);
            }
            
            // Generate labels for each game
            for (let i = 1; i <= maxGames; i++) {
                labels.push(`Game ${i}`);
            }
            
            // Extract data from rating_dict and create datasets
            for (const team in rating_dict) {
                datasets.push({
                    label: team,
                    data: rating_dict[team],
                    fill: false,
                    
                });
            }
            
            const lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets,
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                        }
                    }
                }
            });
        </script>
    </div>
    
</div>
{% endblock %}